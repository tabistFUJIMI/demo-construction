<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‹æ¥­å†…å®¹ç®¡ç† | ãµã˜ã¿DXãƒ©ãƒœå»ºè¨­</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/admin.css">
</head>
<body class="admin-body">
  <header class="admin-header">
    <h1>ãµã˜ã¿DXãƒ©ãƒœå»ºè¨­ ç®¡ç†ç”»é¢</h1>
    <div class="admin-header-right">
      <a href="../index.html" target="_blank">ã‚µã‚¤ãƒˆã‚’è¡¨ç¤º â†—</a>
      <a href="#" id="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </div>
  </header>

  <nav class="admin-sidebar">
    <a href="index.html"><span class="admin-sidebar-icon">ğŸ“Š</span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
    <a href="news-edit.html"><span class="admin-sidebar-icon">ğŸ“°</span>ãŠçŸ¥ã‚‰ã›ç®¡ç†</a>
    <a href="works-edit.html"><span class="admin-sidebar-icon">ğŸ—ï¸</span>æ–½å·¥å®Ÿç¸¾ç®¡ç†</a>
    <a href="services-edit.html" class="active"><span class="admin-sidebar-icon">ğŸ”§</span>äº‹æ¥­å†…å®¹ç®¡ç†</a>
  </nav>

  <main class="admin-main">
    <!-- ä¸€è¦§ -->
    <div id="list-view">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2 style="font-size:20px;color:#1a3a5c;">äº‹æ¥­å†…å®¹ç®¡ç†</h2>
        <button class="admin-btn admin-btn-primary" onclick="showEditor()">ï¼‹ æ–°è¦è¿½åŠ </button>
      </div>
      <div class="admin-card">
        <table class="admin-table">
          <thead><tr><th>é †ç•ª</th><th>ã‚¿ã‚¤ãƒˆãƒ«</th><th>æ¦‚è¦</th><th></th></tr></thead>
          <tbody id="services-table"></tbody>
        </table>
      </div>
    </div>

    <!-- ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="edit-view" style="display:none;">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
        <button class="admin-btn admin-btn-secondary" onclick="showList()">â† æˆ»ã‚‹</button>
        <h2 style="font-size:20px;color:#1a3a5c;" id="form-title">ç·¨é›†</h2>
      </div>
      <div class="admin-card">
        <div class="admin-form">
          <input type="hidden" id="edit-id">

          <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input type="text" id="edit-title" placeholder="ä¾‹: æ–°ç¯‰ä½å®…">

          <label>æ¦‚è¦ï¼ˆä¸€è¦§è¡¨ç¤ºç”¨ãƒ»çŸ­ã‚ï¼‰</label>
          <input type="text" id="edit-summary" placeholder="ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºç”¨ã®çŸ­ã„èª¬æ˜">

          <label>è©³ç´°èª¬æ˜</label>
          <textarea id="edit-description" placeholder="è©³ç´°ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹èª¬æ˜æ–‡"></textarea>

          <label>ç”»åƒURL</label>
          <input type="text" id="edit-image" placeholder="ä¾‹: images/service-newbuild.jpg">
          <div class="admin-upload-preview" id="preview-img" style="margin-top:8px;"></div>

          <label>ç‰¹å¾´ï¼ˆ1è¡Œãšã¤å…¥åŠ›ï¼‰</label>
          <textarea id="edit-features" placeholder="è€éœ‡ç­‰ç´š3å¯¾å¿œ&#10;é«˜æ–­ç†±ãƒ»é«˜æ°—å¯†ä»•æ§˜&#10;è‡ªç”±è¨­è¨ˆã®æ³¨æ–‡ä½å®…" style="min-height:120px;"></textarea>

          <label>è¡¨ç¤ºé †</label>
          <input type="text" id="edit-order" placeholder="1, 2, 3..." style="width:100px;">

          <div class="admin-form-actions">
            <button class="admin-btn admin-btn-primary" onclick="saveItem()">ä¿å­˜ã™ã‚‹</button>
            <button class="admin-btn admin-btn-danger" id="delete-btn" onclick="deleteItem()" style="display:none;">å‰Šé™¤</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="admin-toast" id="toast"></div>

  <script src="../js/services-store.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2500);
    }

    function renderList() {
      const services = ServicesStore.getAll();
      document.getElementById('services-table').innerHTML = services.map(s => {
        return `<tr>
          <td style="font-weight:700;color:#1a3a5c;">${s.order || '-'}</td>
          <td>${s.title}</td>
          <td style="color:#999;font-size:13px;max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${s.summary || ''}</td>
          <td><a href="#" onclick="editItem('${s.id}');return false;" style="color:#2e6b96;font-size:13px;font-weight:600;">ç·¨é›†</a></td>
        </tr>`;
      }).join('');
    }

    function showList() {
      document.getElementById('list-view').style.display = '';
      document.getElementById('edit-view').style.display = 'none';
      renderList();
    }

    function showEditor(id) {
      document.getElementById('list-view').style.display = 'none';
      document.getElementById('edit-view').style.display = '';
      document.getElementById('preview-img').innerHTML = '';
      if (id) {
        const item = ServicesStore.getById(id);
        if (!item) return showList();
        document.getElementById('edit-id').value = item.id;
        document.getElementById('edit-title').value = item.title;
        document.getElementById('edit-summary').value = item.summary || '';
        document.getElementById('edit-description').value = item.description || '';
        document.getElementById('edit-image').value = item.image || '';
        document.getElementById('edit-features').value = (item.features || []).join('\n');
        document.getElementById('edit-order').value = item.order || '';
        if (item.image) {
          document.getElementById('preview-img').innerHTML = `<img src="../${item.image}" alt="preview">`;
        }
        document.getElementById('form-title').textContent = item.title + ' ã®ç·¨é›†';
        document.getElementById('delete-btn').style.display = '';
      } else {
        document.getElementById('edit-id').value = '';
        document.getElementById('edit-title').value = '';
        document.getElementById('edit-summary').value = '';
        document.getElementById('edit-description').value = '';
        document.getElementById('edit-image').value = '';
        document.getElementById('edit-features').value = '';
        document.getElementById('edit-order').value = '';
        document.getElementById('form-title').textContent = 'æ–°è¦è¿½åŠ ';
        document.getElementById('delete-btn').style.display = 'none';
      }
    }

    // Image URL preview
    document.getElementById('edit-image').addEventListener('input', function() {
      const url = this.value.trim();
      const preview = document.getElementById('preview-img');
      if (url) {
        preview.innerHTML = `<img src="../${url}" alt="preview" onerror="this.parentElement.innerHTML=''">`;
      } else {
        preview.innerHTML = '';
      }
    });

    function editItem(id) { showEditor(id); }

    function saveItem() {
      const id = document.getElementById('edit-id').value;
      const title = document.getElementById('edit-title').value.trim();
      if (!title) { alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      const features = document.getElementById('edit-features').value
        .split('\n')
        .map(f => f.trim())
        .filter(f => f);
      ServicesStore.save({
        id: id || undefined,
        title,
        summary: document.getElementById('edit-summary').value,
        description: document.getElementById('edit-description').value,
        image: document.getElementById('edit-image').value,
        features,
        order: parseInt(document.getElementById('edit-order').value) || 0,
      });
      showToast('ä¿å­˜ã—ã¾ã—ãŸ');
      showList();
    }

    function deleteItem() {
      const id = document.getElementById('edit-id').value;
      if (!id) return;
      if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      ServicesStore.delete(id);
      showToast('å‰Šé™¤ã—ã¾ã—ãŸ');
      showList();
    }

    window.onAdminAuth = function () {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (id) { showEditor(id); } else { renderList(); }
    };

    document.getElementById('logout-btn').addEventListener('click', (e) => {
      e.preventDefault();
      sessionStorage.removeItem('admin_auth_hash');
      location.reload();
    });
  </script>
</body>
</html>
